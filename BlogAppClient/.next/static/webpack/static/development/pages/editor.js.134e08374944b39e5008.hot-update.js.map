{"version":3,"file":"static/webpack/static\\development\\pages\\editor.js.134e08374944b39e5008.hot-update.js","sources":["webpack:///./components/RichEditor/postArticle.js"],"sourcesContent":["import React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport less from \"./style.less\";\r\nimport { mergeClassName } from \"utils/utils\";\r\nimport gqlClient from \"GQL/GraphQL\";\r\nimport {\r\n  QUERY_CLASSIFY_AND_LABEL,\r\n  QUERY_LABEL_BY_CLASSIFY,\r\n  getClassifyLabel,\r\n  getLabelByClassify,\r\n  getAllClassify\r\n} from \"GQL/Query\";\r\n\r\nconst defaultClassify = \"前端\";\r\n\r\nclass PostMenu extends Component {\r\n  constructor (props) {\r\n    super(props);\r\n  }\r\n\r\n  render () {\r\n    const {\r\n      isShowMenu,\r\n      initState,\r\n      handleSelectClassify,\r\n      handleSelectLabel,\r\n      currentClassify,\r\n      currentLabel,\r\n      handlePost\r\n    } = this.props;\r\n    return (\r\n      <div className={ mergeClassName(less[\"post-selection\"], isShowMenu && less[\"show-menu\"]) }>\r\n        <h2>发布文章</h2>\r\n        <h3>分类</h3>\r\n        <div className={ less[\"classify\"] }>\r\n          {\r\n            initState.classify ? initState.classify.map(({ name }, i) =>\r\n              <span className={ currentClassify === i ? less.check : \"\" }\r\n                    onClick={ () => {\r\n                      handleSelectClassify(name)\r\n                    } }>{ name }</span>) : \"\"\r\n          }\r\n        </div>\r\n        <h3>标签</h3>\r\n        <div className={ less[\"label\"] }>\r\n          {\r\n            initState.label ? initState.label.map(({ name }, i) =>\r\n              <span className={ currentLabel === i ? less[\"label-check\"] : \"\" } onClick={ () => {\r\n                handleSelectLabel(name);\r\n              } }>{ name }<i className=\"fa fa-check\"/></span>) : \"\"\r\n          }\r\n        </div>\r\n        <button onClick={ handlePost }>发布</button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nPostMenu.propTypes = {\r\n  isShowMenu: PropTypes.bool.isRequired,\r\n  initState: PropTypes.object,\r\n  handleSelectClassify: PropTypes.func,\r\n  handleSelectLabel: PropTypes.func,\r\n  currentClassify: PropTypes.number,\r\n  currentLabel: PropTypes.number,\r\n  handlePost: PropTypes.func\r\n};\r\n\r\n\r\nexport default class Post extends Component {\r\n\r\n  constructor (props) {\r\n    super(props);\r\n    this.state = {\r\n      isShowMenu: false,\r\n      classify: [],\r\n      label: [],\r\n      currentClassify: 0,\r\n      currentLabel: 0\r\n    };\r\n    this.handlePost = this.handlePost.bind(this);\r\n    this.handleSelectClassify = this.handleSelectClassify.bind(this);\r\n    this.handleSelectLabel = this.handleSelectLabel.bind(this);\r\n  }\r\n\r\n  handleSelectClassify (name) {\r\n    const classify = this.state.classify.map(({ name }) => name);\r\n    this.setState({\r\n      currentClassify: classify.indexOf(name)\r\n    });\r\n    getLabelByClassify(name).then(label => this.setState({ label }));\r\n    // gqlClient.query({\r\n    //   query: QUERY_LABEL_BY_CLASSIFY(),\r\n    //   variables: { classify: name }\r\n    // }).then(({ data }) => data)\r\n    //   .then(({ labelByClassify }) => {\r\n    //     this.setState({ label: labelByClassify })\r\n    //   })\r\n  }\r\n\r\n  handleSelectLabel (name) {\r\n    const label = this.state.label.map(({ name }) => name);\r\n    this.setState({\r\n      currentLabel: label.indexOf(name)\r\n    });\r\n  }\r\n\r\n  handlePost () {\r\n    const { classify, currentClassify, label, currentLabel } = this.state;\r\n    const currentClassifyName = classify.map(({ name }) => name)[currentClassify];\r\n    const currentLabelId = label.map(({ id }) => id)[currentLabel];\r\n    this.props.handlePost(currentClassifyName, currentLabelId);\r\n  }\r\n\r\n  componentDidMount () {\r\n    console.log(\"did mount\");\r\n    getAllClassify(defaultClassify).then(\r\n      ({ labelByClassify, classify }) => {\r\n        console.log(\"labelByClassify\",labelByClassify, classify);\r\n        this.setState({\r\n          classify,\r\n          label: labelByClassify\r\n        })\r\n      }\r\n    );\r\n    // gqlClient.query({\r\n    //   query: QUERY_CLASSIFY_AND_LABEL(),\r\n    //   variables: { defaultClassify }\r\n    // }).then(({ data }) => data).then(({ labelByClassify, classify }) => {\r\n    //   console.log(labelByClassify, classify);\r\n    //   this.setState({\r\n    //     classify,\r\n    //     label: labelByClassify\r\n    //   })\r\n    // })\r\n  }\r\n\r\n  render () {\r\n    const { isShowMenu } = this.state;\r\n    return (\r\n      <div className={ mergeClassName(less[\"post-article\"], isShowMenu && less.active) }>\r\n        <button onClick={\r\n          () => this.setState(state => ({\r\n            isShowMenu: !state.isShowMenu\r\n          }))\r\n        }>\r\n          POST <i className={ isShowMenu ? \"fa fa-caret-up\" : \"fa fa-caret-down\" }/>\r\n        </button>\r\n        <div className={ less[\"post-menu\"] }>\r\n          <PostMenu isShowMenu={ isShowMenu }\r\n                    initState={ { classify: this.state.classify, label: this.state.label } }\r\n                    handleSelectClassify={ this.handleSelectClassify }\r\n                    handleSelectLabel={ this.handleSelectLabel }\r\n                    currentLabel={ this.state.currentLabel }\r\n                    currentClassify={ this.state.currentClassify }\r\n                    handlePost={ this.handlePost }\r\n          />\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nPost.propTypes = {\r\n  handlePost: PropTypes.func\r\n};\r\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AAQA;AACA;AACA;;;;;AACA;AAAA;AACA;AADA;AAEA;AACA;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AADA;AAOA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAMA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;;;;AAxCA;AACA;AA0CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAPA;AACA;AAUA;;;;;AAEA;AAAA;AACA;AADA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AALA;AAOA;AACA;AACA;AAXA;AAYA;AACA;;;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AAGA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AADA;AAGA;;;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;;;AAEA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AAFA;AAIA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AAAA;AACA;AADA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AADA;AAAA;AAAA;AADA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AANA;AAAA;AAAA;AAAA;AAAA;AAAA;AAWA;;;;AA3FA;AACA;AADA;AA8FA;AACA;AADA;;;;A","sourceRoot":""}